[tox]
# Tox configuration for testing Gen Scene Studio Backend across multiple Python versions and environments

# Environments
envlist =
    py311,
    py312,
    py311-integration,
    py312-integration,
    py311-performance,
    py312-performance,
    security-scan

# Base configuration
[testenv]
basepython = python3.11
deps =
    pytest>=7.4.3
    pytest-asyncio>=0.21.1
    pytest-cov>=4.1.0
    pytest-mock>=3.12.0
    pytest-xdist>=3.3.1
    pytest-benchmark>=4.0.0
    httpx>=0.25.2
    fastapi[testing]>=0.104.1
    factory-boy>=3.3.0
    faker>=19.12.0
    freezegun>=1.3.0
    locust>=2.17.0
    memory-profiler>=0.61.0
    py-spy>=0.3.14
    black==23.11.0
    isort==5.12.0
    flake8==6.1.0
    mypy==1.7.1
    bandit==1.7.5
    safety==2.3.5
    coverage==7.3.2
    pytest-html==4.1.1
    types-PyYAML>=6.0.12
    types-python-dateutil>=2.8.19.14
    pre-commit==3.5.0
    tox>=4.11.4

commands =
    pytest {posargs}
    pre-commit run --all-files

# Unit testing environments
[py311]
deps = {[testenv]deps}
commands =
    pytest tests/unit/ {posargs}

[py312]
basepython = python3.12
deps = {[testenv]deps}
commands =
    pytest tests/unit/ {posargs}

# Integration testing environments
[py311-integration]
deps = {[testenv]deps}
commands =
    pytest tests/integration/ {posargs}

[py312-integration]
basepython = python3.12
deps = {[testenv]deps}
commands =
    pytest tests/integration/ {posargs}

# Performance testing environments
[py311-performance]
deps = {[testenv]deps}
commands =
    pytest tests/e2e/performance/ -m performance --benchmark-only {posargs}

[py312-performance]
basepython = python3.12
deps = {[testenv]deps}
commands =
    pytest tests/e2e/performance/ -m performance --benchmark-only {posargs}

# End-to-end testing environments
[py311-e2e]
deps = {[testenv]deps}
commands =
    pytest tests/e2e/ {posargs}

[py312-e2e]
basepython = python3.12
deps = {[testenv]deps}
commands =
    pytest tests/e2e/ {posargs}

# Security scanning environment
[security-scan]
deps =
    bandit>=1.7.5
    safety>=2.3.5
    semgrep
commands =
    bandit -r src/ -f json -o security-report.json
    safety check --json --output security-report.json

# Code formatting and linting
[format]
deps = {[testenv]deps}
skip_install = true
commands =
    black --check --diff --color src/ tests/
    isort --check-only --diff --color src/ tests/
    flake8 --max-line-length=100 --extend-ignore=E203,W503 src/ tests/
    mypy src/ --ignore-missing-imports

# Coverage reporting
[coverage]
deps = {[testenv]deps}
commands =
    pytest --cov=src --cov-report=html --cov-report=term-missing --cov-report=xml tests/unit/ tests/integration/

# Parallel testing
[parallel]
deps = {[testenv]deps}
commands =
    pytest -n auto tests/unit/ tests/integration/

# Documentation building
[docs]
deps =
    mkdocs>=1.5.0
    mkdocs-material>=9.4.0
commands =
    mkdocs build

# Development environment
[dev]
deps = {[testenv]deps}
extras =
    dev
commands =
    pre-commit install
    pre-commit run --all-files
    pytest tests/ {posargs}

# Production dependency checking
[prod-deps]
deps =
    pip-tools
    safety
commands =
    pip-compile requirements.in -o requirements.txt
    safety check